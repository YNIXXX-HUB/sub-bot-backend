<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Growth | Free YouTube Subs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #0f0f13; --panel: #18181b; --accent: #6366f1; --accent-hover: #4f46e5; --text: #ffffff; --red: #ef4444; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 100; display: flex; align-items: center; justify-content: center; }
        .auth-box { background: var(--panel); padding: 40px; border-radius: 12px; width: 350px; text-align: center; border: 1px solid #27272a; }
        .auth-box h1 { margin-bottom: 20px; color: var(--accent); }
        input { width: 100%; background: #27272a; border: 1px solid #3f3f46; padding: 12px; color: white; border-radius: 6px; margin-bottom: 10px; outline: none; }
        input:focus { border-color: var(--accent); }
        button { width: 100%; background: var(--accent); color: white; border: none; padding: 12px; border-radius: 6px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:hover { background: var(--accent-hover); }
        .switch-btn { background: transparent; color: #a1a1aa; margin-top: 10px; font-size: 0.9rem; }
        .error-msg { color: var(--red); font-size: 0.9rem; margin-bottom: 10px; height: 20px; }

        /* DASHBOARD LAYOUT */
        #dashboard { display: none; height: 100vh; display: flex; }
        .sidebar { width: 250px; background: var(--panel); padding: 20px; border-right: 1px solid #27272a; }
        .main-feed { flex: 1; padding: 20px; overflow-y: auto; }
        .chat-panel { width: 300px; background: var(--panel); border-left: 1px solid #27272a; display: flex; flex-direction: column; }
        
        .logo { font-size: 1.5rem; color: var(--accent); font-weight: 800; margin-bottom: 30px; }
        .stat-box { background: #27272a; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .card { background: var(--panel); border: 1px solid #27272a; padding: 15px; margin-bottom: 10px; border-radius: 8px; position: relative; }
        .card-tag { position: absolute; top: 10px; right: 10px; background: #27272a; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; }
        
        .chat-messages { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .chat-input { padding: 15px; border-top: 1px solid #27272a; }
        .msg strong { color: var(--accent); }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- LOGIN SCREEN -->
    <div id="auth-screen">
        <div class="auth-box">
            <h1>Nexus Growth</h1>
            
            <div id="login-form">
                <p id="l-error" class="error-msg"></p>
                <input type="text" id="l-user" placeholder="Username">
                <input type="password" id="l-pass" placeholder="Password">
                <button onclick="login()">Log In</button>
                <button class="switch-btn" onclick="toggleAuth()">Create an Account</button>
            </div>

            <div id="signup-form" class="hidden">
                <p id="s-error" class="error-msg"></p>
                <input type="text" id="s-user" placeholder="Choose Username">
                <input type="password" id="s-pass" placeholder="Choose Password">
                <button onclick="signup()">Sign Up</button>
                <button class="switch-btn" onclick="toggleAuth()">Back to Login</button>
            </div>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="dashboard" class="hidden">
        <div class="sidebar">
            <div class="logo">Nexus ðŸš€</div>
            <div class="stat-box">
                <h3 id="display-user">User</h3>
                <p>Points: <span id="points-val" style="color:var(--accent)">0</span></p>
                <p>Level: <span id="level-val">1</span></p>
            </div>
            <button onclick="location.reload()" style="background:#27272a; margin-top:20px;">Logout</button>
        </div>

        <div class="main-feed">
             <div style="background: #27272a; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3>Promote (-50 Pts)</h3>
                <input type="text" id="promo-url" placeholder="https://youtube.com/..." style="margin-top:10px;">
                <button onclick="promote()" style="margin-top:5px;">Promote Channel</button>
            </div>
            <div id="feed">Loading promotions...</div>
        </div>

        <div class="chat-panel">
            <div style="padding:15px; border-bottom:1px solid #27272a;"><strong>Live Chat</strong></div>
            <div class="chat-messages" id="chat-box"></div>
            <div class="chat-input">
                <input type="text" id="chat-msg" placeholder="Type message..." onkeypress="handleEnter(event)">
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentUser = null;

        function toggleAuth() {
            document.getElementById('login-form').classList.toggle('hidden');
            document.getElementById('signup-form').classList.toggle('hidden');
            document.getElementById('l-error').innerText = "";
            document.getElementById('s-error').innerText = "";
        }

        async function login() {
            const u = document.getElementById('l-user').value;
            const p = document.getElementById('l-pass').value;
            document.getElementById('l-error').innerText = "Logging in...";
            
            try {
                const res = await fetch('/api/login', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                
                if(data.success) {
                    currentUser = data.username;
                    localStorage.setItem('nexus_user', currentUser);
                    showDash();
                    loadData();
                } else {
                    document.getElementById('l-error').innerText = data.error;
                }
            } catch (e) {
                document.getElementById('l-error').innerText = "Connection Error. Server might be sleeping.";
            }
        }

        async function signup() {
            const u = document.getElementById('s-user').value;
            const p = document.getElementById('s-pass').value;
            document.getElementById('s-error').innerText = "Creating account...";

            try {
                const res = await fetch('/api/signup', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                
                if(data.success) {
                    alert("Success! Please Log In.");
                    toggleAuth();
                } else {
                    document.getElementById('s-error').innerText = data.error;
                }
            } catch (e) {
                document.getElementById('s-error').innerText = "Server Error.";
            }
        }

        function showDash() {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('display-user').innerText = currentUser;
        }

        async function loadData() {
            const res = await fetch('/api/data', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser})
            });
            const data = await res.json();
            document.getElementById('points-val').innerText = data.points;
            document.getElementById('level-val').innerText = Math.floor(data.xp / 100) + 1;
            
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            data.links.forEach(link => addCard(link));
        }

        function addCard(link) {
            const feed = document.getElementById('feed');
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div class="card-tag">${link.type}</div>
                <h4>${link.owner}</h4>
                <a href="${link.url}" target="_blank"><button style="margin-top:10px;">Visit</button></a>
            `;
            feed.prepend(div);
        }

        async function promote() {
            const url = document.getElementById('promo-url').value;
            const res = await fetch('/api/promote', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser, url: url, type: 'channel'})
            });
            const data = await res.json();
            if(data.success) alert("Promoted!");
            else alert(data.error);
        }

        // CHAT
        function handleEnter(e) { if(e.key === 'Enter') { 
            socket.emit('send_message', {username: currentUser, message: document.getElementById('chat-msg').value});
            document.getElementById('chat-msg').value = '';
        }}
        socket.on('receive_message', (data) => {
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="msg"><strong>${data.username}: </strong>${data.message}</div>`;
            box.scrollTop = box.scrollHeight;
        });
        socket.on('new_promotion', (link) => addCard(link));
        socket.on('update_stats', (data) => {
            if(data.username === currentUser) document.getElementById('points-val').innerText = parseInt(document.getElementById('points-val').innerText) + data.points;
        });
    </script>
</body>
</html>
