<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Growth | Premium</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #09090b;
            --panel: #18181b;
            --border: #27272a;
            --accent: #6366f1; /* Indigo-500 */
            --accent-hover: #4f46e5;
            --text-main: #ffffff;
            --text-dim: #a1a1aa;
            --danger: #ef4444;
            --success: #22c55e;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        /* AUTH SCREEN */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 50; display: flex; align-items: center; justify-content: center; }
        .glass-panel { background: var(--panel); border: 1px solid var(--border); padding: 40px; border-radius: 16px; width: 400px; text-align: center; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        .brand-title { font-size: 2rem; font-weight: 800; color: var(--accent); margin-bottom: 5px; letter-spacing: -1px; }
        .subtitle { color: var(--text-dim); font-size: 0.9rem; margin-bottom: 25px; }
        
        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; color: var(--text-dim); font-size: 0.8rem; margin-bottom: 5px; }
        input { width: 100%; background: #27272a; border: 1px solid #3f3f46; color: white; padding: 12px; border-radius: 8px; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }
        
        .btn-primary { width: 100%; background: var(--accent); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; }
        .btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); }
        .btn-link { background: none; border: none; color: var(--text-dim); margin-top: 15px; cursor: pointer; font-size: 0.9rem; }
        .btn-link:hover { color: white; text-decoration: underline; }
        
        .error-banner { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--danger); color: var(--danger); padding: 10px; border-radius: 8px; font-size: 0.9rem; margin-bottom: 15px; display: none; }

        /* MAIN APP LAYOUT */
        #app-layout { display: none; height: 100vh; display: flex; }
        
        /* SIDEBAR */
        aside { width: 260px; background: var(--panel); border-right: 1px solid var(--border); padding: 25px; display: flex; flex-direction: column; }
        .user-profile { background: #27272a; padding: 15px; border-radius: 12px; border: 1px solid var(--border); margin-bottom: 30px; }
        .user-name { font-weight: 700; font-size: 1.1rem; }
        .user-stats { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.9rem; color: var(--text-dim); }
        .stat-value { color: var(--accent); font-weight: bold; }
        
        .menu-item { display: block; padding: 12px; border-radius: 8px; color: var(--text-dim); text-decoration: none; margin-bottom: 5px; cursor: pointer; transition: 0.2s; }
        .menu-item:hover { background: #27272a; color: white; }
        .menu-item.active { background: rgba(99, 102, 241, 0.1); color: var(--accent); }

        /* CENTER FEED */
        main { flex: 1; padding: 30px; overflow-y: auto; }
        .feed-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        
        .promo-creator { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 30px; }
        .promo-row { display: flex; gap: 10px; margin-top: 15px; }
        
        .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; transition: 0.2s; position: relative; overflow: hidden; }
        .card:hover { border-color: var(--accent); transform: translateY(-3px); }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--accent); opacity: 0.5; }
        .card h3 { font-size: 1.1rem; margin-bottom: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        /* CHAT */
        .chat-section { width: 320px; background: var(--panel); border-left: 1px solid var(--border); display: flex; flex-direction: column; }
        .chat-head { padding: 20px; border-bottom: 1px solid var(--border); font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .live-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; box-shadow: 0 0 10px var(--success); }
        .chat-body { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .chat-msg { font-size: 0.9rem; line-height: 1.4; }
        .chat-user { color: var(--accent); font-weight: 700; margin-right: 5px; }
        .chat-foot { padding: 20px; border-top: 1px solid var(--border); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- AUTH SCREEN -->
    <div id="auth-overlay">
        <div class="glass-panel">
            <div class="brand-title">Nexus ðŸš€</div>
            <div class="subtitle">The #1 Growth Exchange Platform</div>
            <div id="error-banner" class="error-banner"></div>

            <!-- LOGIN -->
            <div id="login-view">
                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="l-user">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="l-pass">
                </div>
                <button class="btn-primary" onclick="handleLogin()">Log In</button>
                <button class="btn-link" onclick="switchView('signup')">Create an Account</button>
            </div>

            <!-- SIGNUP -->
            <div id="signup-view" class="hidden">
                <div class="input-group">
                    <label>Choose Username</label>
                    <input type="text" id="s-user">
                </div>
                <div class="input-group">
                    <label>Choose Password</label>
                    <input type="password" id="s-pass">
                </div>
                <button class="btn-primary" onclick="handleSignup()">Sign Up</button>
                <button class="btn-link" onclick="switchView('login')">Back to Login</button>
            </div>
        </div>
    </div>

    <!-- APP INTERFACE -->
    <div id="app-layout">
        <aside>
            <div class="brand-title" style="font-size: 1.5rem; margin-bottom: 30px;">Nexus</div>
            
            <div class="user-profile">
                <div class="user-name" id="display-name">Guest</div>
                <div class="user-stats">
                    <span>Points</span>
                    <span class="stat-value" id="display-points">0</span>
                </div>
            </div>

            <div class="menu-item active">ðŸ”¥ Dashboard</div>
            <div class="menu-item" onclick="alert('Install Script to Earn!')">ðŸ“œ Get Script</div>
            <div style="flex:1"></div>
            <div class="menu-item" style="color:var(--danger)" onclick="location.reload()">Log Out</div>
        </aside>

        <main>
            <div class="promo-creator">
                <h3>ðŸš€ Promote Your Channel</h3>
                <p style="color:var(--text-dim); font-size:0.9rem;">Cost: 50 Points per promotion</p>
                <div class="promo-row">
                    <input type="text" id="promo-url" placeholder="https://youtube.com/channel/..." style="flex:1">
                    <button class="btn-primary" style="width: auto;" onclick="promote()">Promote</button>
                </div>
            </div>

            <div class="feed-header">
                <h3>Active Promotions</h3>
                <button class="btn-link" style="margin:0; color:var(--accent)" onclick="loadData()">Refresh Feed</button>
            </div>

            <div class="card-grid" id="feed-container">
                <!-- Cards inject here -->
            </div>
        </main>

        <div class="chat-section">
            <div class="chat-head">
                <div class="live-dot"></div> Live Global Chat
            </div>
            <div class="chat-body" id="chat-box">
                <!-- Messages -->
            </div>
            <div class="chat-foot">
                <input type="text" id="chat-input" placeholder="Type a message..." onkeypress="if(event.key==='Enter') sendChat()">
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentUser = null;

        function showError(msg) {
            const el = document.getElementById('error-banner');
            el.innerText = msg;
            el.style.display = 'block';
        }

        function switchView(view) {
            document.getElementById('login-view').classList.toggle('hidden');
            document.getElementById('signup-view').classList.toggle('hidden');
            document.getElementById('error-banner').style.display = 'none';
        }

        async function handleLogin() {
            const u = document.getElementById('l-user').value;
            const p = document.getElementById('l-pass').value;
            try {
                const res = await fetch('/api/login', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if(data.success) {
                    currentUser = data.username;
                    localStorage.setItem('nexus_user', currentUser);
                    enterApp(data);
                } else showError(data.error);
            } catch(e) { showError("Database Connection Failed. Check Render Settings."); }
        }

        async function handleSignup() {
            const u = document.getElementById('s-user').value;
            const p = document.getElementById('s-pass').value;
            try {
                const res = await fetch('/api/signup', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({username: u, password: p})
                });
                const data = await res.json();
                if(data.success) { alert("Account Created! Please Login."); switchView('login'); }
                else showError(data.error);
            } catch(e) { showError("Database Connection Failed."); }
        }

        function enterApp(data) {
            document.getElementById('auth-overlay').style.display = 'none';
            document.getElementById('app-layout').style.display = 'flex';
            document.getElementById('display-name').innerText = currentUser;
            document.getElementById('display-points').innerText = data.points;
            loadData();
        }

        async function promote() {
            const url = document.getElementById('promo-url').value;
            const res = await fetch('/api/promote', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser, url: url, type: 'channel'})
            });
            const data = await res.json();
            if(data.success) alert("Promoted Successfully!"); else alert(data.error);
        }

        async function loadData() {
            const res = await fetch('/api/data', {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username: currentUser})
            });
            const data = await res.json();
            const feed = document.getElementById('feed-container');
            feed.innerHTML = "";
            data.links.forEach(l => {
                feed.innerHTML += `
                <div class="card">
                    <div style="position:absolute; top:10px; right:10px; font-size:0.7rem; color:#a1a1aa;">CHANNEL</div>
                    <h3>${l.owner}</h3>
                    <a href="${l.url}" target="_blank"><button class="btn-primary" style="padding:8px 15px;">Visit & Sub</button></a>
                </div>`;
            });
        }

        function sendChat() {
            const input = document.getElementById('chat-input');
            if(!input.value) return;
            socket.emit('send_message', {username: currentUser, message: input.value});
            input.value = '';
        }

        socket.on('receive_message', (d) => {
            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="chat-msg"><span class="chat-user">${d.username}:</span>${d.message}</div>`;
            box.scrollTop = box.scrollHeight;
        });
        
        socket.on('new_promotion', () => loadData());
        socket.on('update_stats', (d) => { if(d.username === currentUser) document.getElementById('display-points').innerText = parseInt(document.getElementById('display-points').innerText) + d.points; });
    </script>
</body>
</html>
